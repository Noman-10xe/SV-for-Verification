--------- [DRIVER] Reset Started ---------
--------- [DRIVER] Reset Ended ---------
--------- [DRIVER-TRANSFER: 0] ---------
--------- [Driver - 0] Driven Data  ------
	 HADDR 		= 0x0
	 HWDATA 	= 0x2b5c2c6e
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 0
---------------------------------------------

--------- [DRIVER-TRANSFER: 1] ---------
--------- [Monitor - 0] Parsed Data  ------
	 HADDR 		= 0x0
	 HWDATA 	= 0x0
	 HRDATA 	= 0xdeadbeef
	 HWRITE		= 0
	 HSIZE 		= 0
	 HBURST 	= 0
	 HPROT 		= 0
	 HTRANS		= 0
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 0
	 HRESETn 	= 1
	 no_transactions 	= 0
---------------------------------------------

[SCB] :: Transfer Can be Initiated
--------- [Monitor - 1] Parsed Data  ------
	 HADDR 		= 0x0
	 HWDATA 	= 0x2b5c2c6e
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 1
	 no_transactions 	= 1
---------------------------------------------

--------- [Driver - 1] Driven Data  ------
	 HADDR 		= 0x0
	 HWDATA 	= 0xcf578554
	 HRDATA 	= 0xdeadbeef
	 HWRITE		= 0
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 1
---------------------------------------------

--------- [DRIVER-TRANSFER: 2] ---------
[SCB] :: Transfer Can be Initiated
[SCB] :: Protection is set to DATA ACCESS Only
[SCB] :: Slave has been Selected
[SCB-PASS] :: (HALFWORD) WRITE OPERATION :: Expected = 2c6e, Actual = 2c6e
--------- [Driver - 2] Driven Data  ------
	 HADDR 		= 0x4
	 HWDATA 	= 0xfad5c89b
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 2
---------------------------------------------

--------- [DRIVER-TRANSFER: 3] ---------
--------- [Monitor - 2] Parsed Data  ------
	 HADDR 		= 0x0
	 HWDATA 	= 0x0
	 HRDATA 	= 0xdead2c6e
	 HWRITE		= 0
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 1
	 no_transactions 	= 2
---------------------------------------------

[SCB] :: Transfer Can be Initiated
[SCB] :: Protection is set to DATA ACCESS Only
[SCB] :: Slave has been Selected
[SCB-PASS] :: (HALFWORD) READ OPERATION :: Expected = 2c6e, Actual = 2c6e
--------- [Monitor - 3] Parsed Data  ------
	 HADDR 		= 0x4
	 HWDATA 	= 0xfad5c89b
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 1
	 no_transactions 	= 3
---------------------------------------------

--------- [Driver - 3] Driven Data  ------
	 HADDR 		= 0x4
	 HWDATA 	= 0xcf21010
	 HRDATA 	= 0xdeadbeef
	 HWRITE		= 0
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 3
---------------------------------------------

--------- [DRIVER-TRANSFER: 4] ---------
[SCB] :: Transfer Can be Initiated
[SCB] :: Protection is set to DATA ACCESS Only
[SCB] :: Slave has been Selected
[SCB-PASS] :: (HALFWORD) WRITE OPERATION :: Expected = c89b, Actual = c89b
--------- [Driver - 4] Driven Data  ------
	 HADDR 		= 0x8
	 HWDATA 	= 0xaeb011de
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 4
---------------------------------------------

--------- [DRIVER-TRANSFER: 5] ---------
--------- [Monitor - 4] Parsed Data  ------
	 HADDR 		= 0x4
	 HWDATA 	= 0x0
	 HRDATA 	= 0xdeadc89b
	 HWRITE		= 0
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 1
	 no_transactions 	= 4
---------------------------------------------

[SCB] :: Transfer Can be Initiated
[SCB] :: Protection is set to DATA ACCESS Only
[SCB] :: Slave has been Selected
[SCB-FAIL] :: (HALFWORD) READ OPERATION :: Expected = beef, Actual = c89b
--------- [Monitor - 5] Parsed Data  ------
	 HADDR 		= 0x8
	 HWDATA 	= 0xaeb011de
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 1
	 no_transactions 	= 5
---------------------------------------------

--------- [Driver - 5] Driven Data  ------
	 HADDR 		= 0x8
	 HWDATA 	= 0x79e8075f
	 HRDATA 	= 0xdeadbeef
	 HWRITE		= 0
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 5
---------------------------------------------

--------- [DRIVER-TRANSFER: 6] ---------
[SCB] :: Transfer Can be Initiated
[SCB] :: Protection is set to DATA ACCESS Only
[SCB] :: Slave has been Selected
[SCB-PASS] :: (HALFWORD) WRITE OPERATION :: Expected = 11de, Actual = 11de
--------- [Driver - 6] Driven Data  ------
	 HADDR 		= 0xc
	 HWDATA 	= 0xbc3080d8
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 6
---------------------------------------------

--------- [DRIVER-TRANSFER: 7] ---------
--------- [Monitor - 6] Parsed Data  ------
	 HADDR 		= 0x8
	 HWDATA 	= 0x0
	 HRDATA 	= 0xdead11de
	 HWRITE		= 0
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 1
	 no_transactions 	= 6
---------------------------------------------

[SCB] :: Transfer Can be Initiated
[SCB] :: Protection is set to DATA ACCESS Only
[SCB] :: Slave has been Selected
[SCB-FAIL] :: (HALFWORD) READ OPERATION :: Expected = beef, Actual = 11de
--------- [Monitor - 7] Parsed Data  ------
	 HADDR 		= 0xc
	 HWDATA 	= 0xbc3080d8
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 1
	 no_transactions 	= 7
---------------------------------------------

--------- [Driver - 7] Driven Data  ------
	 HADDR 		= 0xc
	 HWDATA 	= 0xad9a49ab
	 HRDATA 	= 0xdeadbeef
	 HWRITE		= 0
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 7
---------------------------------------------

--------- [DRIVER-TRANSFER: 8] ---------
[SCB] :: Transfer Can be Initiated
[SCB] :: Protection is set to DATA ACCESS Only
[SCB] :: Slave has been Selected
[SCB-PASS] :: (HALFWORD) WRITE OPERATION :: Expected = 80d8, Actual = 80d8
--------- [Driver - 8] Driven Data  ------
	 HADDR 		= 0x10
	 HWDATA 	= 0x3af75429
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 8
---------------------------------------------

--------- [DRIVER-TRANSFER: 9] ---------
--------- [Monitor - 8] Parsed Data  ------
	 HADDR 		= 0xc
	 HWDATA 	= 0x0
	 HRDATA 	= 0xdead80d8
	 HWRITE		= 0
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 1
	 no_transactions 	= 8
---------------------------------------------

[SCB] :: Transfer Can be Initiated
[SCB] :: Protection is set to DATA ACCESS Only
[SCB] :: Slave has been Selected
[SCB-FAIL] :: (HALFWORD) READ OPERATION :: Expected = beef, Actual = 80d8
--------- [Monitor - 9] Parsed Data  ------
	 HADDR 		= 0x10
	 HWDATA 	= 0x3af75429
	 HRDATA 	= 0x0
	 HWRITE		= 1
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 1
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 1
	 no_transactions 	= 9
---------------------------------------------

--------- [Driver - 9] Driven Data  ------
	 HADDR 		= 0x10
	 HWDATA 	= 0x5a975252
	 HRDATA 	= 0xdeadbeef
	 HWRITE		= 0
	 HSIZE 		= 1
	 HBURST 	= 0
	 HPROT 		= 1
	 HTRANS		= 10
	 HREADYOUT	= 0
	 HREADY 	= 1
	 HRESP 		= 0
	 HSEL 		= 1
	 HRESETn 	= 0
	 no_transactions 	= 9
---------------------------------------------

[SCB] :: Transfer Can be Initiated
[SCB] :: Protection is set to DATA ACCESS Only
[SCB] :: Slave has been Selected
[SCB-PASS] :: (HALFWORD) WRITE OPERATION :: Expected = 5429, Actual = 5429
$finish called from file "environment.sv", line 119.
$finish at simulation time                  165
           V C S   S i m u l a t i o n   R e p o r t 
Time: 165
CPU Time:      0.180 seconds;       Data structure size:   0.0Mb

---------------------------------------------------


/////////////////////////////////////////////////////////////////////
//   								   //
//   		        WRAP4 BURST Transfer                       //
//                         (Bonus Task)                            //
//                                                                 //
/////////////////////////////////////////////////////////////////////
//                                                                 //
//             Copyright (C) 2024 10xEngineers 	                   //
//             www.10xengineers.ai                                 //
//                                                                 //
/////////////////////////////////////////////////////////////////////
// FILE NAME      : wrap4_burst_test.sv
// DESCRIPTION    : Verifies a write Transfer using a 4-beat WRAPPING 
// BURST Operation
// AUTHOR         : Noman Rafiq
// AUTHOR'S EMAIL : noman.rafiq@10xengineers.ai
// ------------------------------------------------------------------
// RELEASE HISTORY													 
// ------------------------------------------------------------------
// VERSION DATE        	AUTHOR         								 
// 1.0     2024-OCT-09  Noman Rafiq 						 		 
// ------------------------------------------------------------------

`include "environment.sv"

//////////////////////////////////////////////////////////////////
//
// Program Definition
//
program test(ahb3_lite ahb_intf);

  class my_trans extends transaction;
  
    // Variable to manage write and read operations
    bit write_done;
    bit [7:0] wr_addr[0:3]; // Store addresses for WRAP4 Burst
    
    
    //////////////////////////////////////////////////////////////////
    //
    // Pre-Randomize Function
    //
    function void pre_randomize();
      HWRITE.rand_mode(0);
      HBURST.rand_mode(0);
      HSIZE.rand_mode(0);
      HREADY.rand_mode(0);
      c_HREADY.constraint_mode(0);
      c_HADDR.constraint_mode(0);
      HTRANS.rand_mode(0);
      HADDR.rand_mode(0);
      
      HSIZE     = 3'd2;                 // WORD SIZED BURSTS
      HBURST    = 3'd2;                 // WRAP4 BURST
      
      if (!write_done) begin
        
        // Perform Write Operation
        HWRITE    = 1;
        
        case (cnt)
          // T0 - T1 (NONSEQ)
          8'h38 : begin
            HADDR   = cnt;
            HREADY  = 1;
            HTRANS  = 2'd2;             // Start BURST with a NONSEQ Transfer
            wr_addr[0] = HADDR;         // Store address
          end
          
          // T1 - T2 (SEQ)
          8'h3C : begin
            HADDR   = cnt;
            HREADY  = 1;
            HTRANS  = 2'd3;             // SEQ Transfer
            wr_addr[1] = HADDR;         // Store address
          end
          
          // T2 - T3 (SEQ)
          8'h40 : begin
            HADDR   = cnt - 4;          // Keep Address Constant (0x3C)
            HREADY  = 1;
            HTRANS  = 2'd3;             // SEQ Transfer
            wr_addr[2] = HADDR;         // Store address
          end
          
          // T3 - T4 (SEQ)
          8'h44 : begin
            HADDR   = cnt - 20;         // ADDRESS = (0x30)
            HREADY  = 1;
            HTRANS  = 2'd3;             // SEQ Transfer
            wr_addr[3] = HADDR;         // Store address
          end
          
          default: begin
            write_done = 1;             // Mark write as done
            cnt = 8'h38;                // Reset counter
          end
        endcase
      end
      
      else begin
        // Perform Read Operation after write
        HWRITE = 0;
        HREADY = 1;
        HTRANS = 2'd2;                  // NONSEQ Transfer for read
        
        case (cnt)
          // Read from stored write addresses
          8'h38: HADDR = wr_addr[0];
          8'h3C: HADDR = wr_addr[1];
          8'h40: HADDR = wr_addr[2];
          8'h44: HADDR = wr_addr[3];
          
          default: write_done = 0;      // Reset after read
        endcase
      end
      
      cnt = cnt + 4;                   // For Word Operation
    endfunction

  endclass

  //////////////////////////////////////////////////////////////////
  //
  // Declaration
  //
  environment env;
  my_trans my_tr;

  initial begin
    my_tr 			= new();
    env 			= new(ahb_intf);        // Initialization
    env.gen.t 		        = my_tr;
    my_tr.cnt                   = 8'h38;
    env.gen.repeat_count 	= 10;	                // Set the repeat count of generator as 10
    env.run;						// Call run method for environment
  end
    
endprogram
